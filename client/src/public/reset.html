<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <form class="reset-password" id="reset-password">
            <div class="input-control">
                <label for="password">Password: <input type="password" name="password" required /></label>
            </div>

            <button type="submit">Reset Password</button>
        </form>
    </div>

    <script>
        const resetPassword = document.getElementById("reset-password")
        resetPassword.addEventListener("submit", reset)
        async function reset(e) {
            try {
                e.preventDefault()

                const field_values = Object.values(resetPassword).reduce((obj, field) => {
                    if (field.name) {
                        obj[field.name] = field.value

                    }
                    return obj
                }, {})

                // get email, time and token from url
                const [email, expTime, token] = window.location.pathname.split("/").slice(-3);

                // send data to server
                const values = {
                    ...field_values,
                    email: decodeURIComponent(email),
                    expTime, token
                }
                // const httpsAgent = new https.Agent({
                //     rejectUnauthorized: false,
                // });

                const result = await fetch("https://api.hari.dev/reset", {
                    method: "POST",
                    body: JSON.stringify(values),
                    credentials: "include",
                    headers: { "Content-type": "application/json; charset=UTF-8" },
                });

            } catch (error) {
                console.log(error)
            }
        }
    </script>
</body>

</html>